# PRD: Арендо-Соседи MVP

> Product Requirements Document для минимально жизнеспособного продукта

---
**Документ:** PRODUCT-002
**Версия:** 1.0
**Дата:** 2025-02-05
**Автор:** Product Agent
**Статус:** Draft
---

## 1. Обзор продукта

### 1.1 Название
**Арендо-Соседи** (рабочее название)

### 1.2 Описание
Telegram WebApp для гиперлокальной P2P-аренды вещей между соседями в рамках жилого комплекса.

### 1.3 Цель MVP
Валидировать Product-Market Fit через запуск в 3-5 ЖК с целью получить 20+ успешных аренд и NPS > 40.

### 1.4 Целевая аудитория MVP
- Жители новостроек с активными домовыми чатами в Telegram
- Возраст 25-45 лет
- Средний доход и выше

---

## 2. Функциональные требования

### 2.1 Модуль: Аутентификация и профиль

#### FR-001: Регистрация через Telegram
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Пользователь авторизуется через Telegram WebApp |

**Детали:**
- Получение данных из Telegram (user_id, first_name, last_name, username, photo_url)
- Создание профиля при первом входе
- Валидация initData от Telegram

**Acceptance Criteria:**
- [ ] При открытии WebApp пользователь автоматически авторизован
- [ ] Данные из Telegram корректно сохраняются в профиль
- [ ] При повторном входе профиль сохраняется

---

#### FR-002: Привязка к жилому комплексу
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Пользователь указывает свой ЖК для гиперлокальности |

**Детали:**
- Список ЖК (MVP: ручное добавление администратором)
- Пользователь выбирает из списка или вводит название
- Возможность смены ЖК (с ограничением)

**Acceptance Criteria:**
- [ ] Пользователь обязан выбрать ЖК при первом входе
- [ ] Каталог показывает только вещи из его ЖК
- [ ] Администратор может добавлять новые ЖК

---

#### FR-003: Профиль пользователя
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Просмотр и редактирование профиля |

**Поля профиля:**
- Фото (из Telegram)
- Имя (из Telegram)
- ЖК
- Номер квартиры (опционально)
- Телефон (опционально)
- Рейтинг как владельца
- Рейтинг как арендатора
- Количество сделок

**Acceptance Criteria:**
- [ ] Пользователь может просмотреть свой профиль
- [ ] Пользователь может добавить номер квартиры и телефон
- [ ] Рейтинг рассчитывается автоматически

---

### 2.2 Модуль: Каталог вещей

#### FR-004: Просмотр каталога
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Просмотр доступных для аренды вещей в ЖК |

**Детали:**
- Список вещей с карточками (фото, название, цена)
- Фильтрация по категориям
- Сортировка (новые, дешёвые, рейтинг)
- Поиск по названию

**Категории MVP:**
1. Инструменты (дрель, перфоратор, шуруповёрт...)
2. Спорт (велосипед, самокат, лыжи, ролики...)
3. Техника (проектор, колонки, камера...)
4. Детское (коляска, кроватка, игрушки...)
5. Мероприятия (палатка, мангал, шатёр...)
6. Другое

**Acceptance Criteria:**
- [ ] Каталог загружается за <2 сек
- [ ] Фильтр по категориям работает
- [ ] Поиск находит по названию и описанию
- [ ] Показываются только вещи из ЖК пользователя

---

#### FR-005: Карточка вещи
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Детальная страница вещи |

**Информация:**
- Фото (до 5 шт., галерея)
- Название
- Описание
- Категория
- Цена за сутки
- Размер депозита
- Рейтинг вещи
- Количество аренд
- Владелец (имя, рейтинг, фото)
- Статус (доступна / занята)
- Кнопка "Забронировать"

**Acceptance Criteria:**
- [ ] Все данные отображаются корректно
- [ ] Галерея фото работает (свайп)
- [ ] Кнопка "Забронировать" активна если вещь доступна
- [ ] Клик по владельцу открывает его профиль

---

#### FR-006: Создание листинга
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Владелец добавляет вещь в каталог |

**Поля:**
| Поле | Тип | Обязательное |
|------|-----|--------------|
| Фото | File (1-5) | Да |
| Название | String (3-100) | Да |
| Описание | Text (10-1000) | Да |
| Категория | Select | Да |
| Цена/сутки | Number (50-50000) | Да |
| Депозит | Number (0-100000) | Нет (default = цена*2) |

**Acceptance Criteria:**
- [ ] Минимум 1 фото обязательно
- [ ] Валидация всех полей
- [ ] После создания вещь появляется в каталоге
- [ ] Владелец получает уведомление об успешном создании

---

#### FR-007: Управление листингами
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Редактирование и удаление своих вещей |

**Функции:**
- Список "Мои вещи"
- Редактирование любого поля
- Временное скрытие (пауза)
- Удаление

**Acceptance Criteria:**
- [ ] Владелец видит список своих вещей
- [ ] Можно редактировать вещь (если нет активной аренды)
- [ ] Можно скрыть/показать вещь
- [ ] Удаление требует подтверждения

---

### 2.3 Модуль: Бронирование и аренда

#### FR-008: Бронирование вещи
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Арендатор бронирует вещь на определённые даты |

**Процесс:**
1. Выбрать даты (начало - конец)
2. Увидеть расчёт (цена * дни + депозит)
3. Добавить комментарий (опционально)
4. Подтвердить бронирование

**Acceptance Criteria:**
- [ ] Нельзя выбрать прошедшие даты
- [ ] Нельзя выбрать занятые даты
- [ ] Расчёт показывается до оплаты
- [ ] Минимальный срок аренды = 1 день

---

#### FR-009: Оплата аренды
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Оплата через YooKassa |

**Что оплачивается:**
- Стоимость аренды (цена * дни)
- Депозит
- Комиссия сервиса (включена в цену)

**Процесс:**
1. Переход на страницу оплаты YooKassa
2. Оплата картой
3. Возврат в WebApp с результатом
4. Деньги на эскроу до завершения

**Acceptance Criteria:**
- [ ] Оплата через YooKassa работает
- [ ] При успешной оплате бронирование подтверждается
- [ ] При неуспешной — показывается ошибка
- [ ] Депозит блокируется, но не списывается

---

#### FR-010: Статусы аренды
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Жизненный цикл аренды |

**Статусы:**
```
pending_payment → paid → confirmed → in_progress →
  → completed → reviewed
  → disputed → resolved
  → cancelled → refunded
```

| Статус | Описание | Кто меняет |
|--------|----------|------------|
| pending_payment | Ожидает оплаты | Система |
| paid | Оплачено, ожидает владельца | Система |
| confirmed | Владелец подтвердил | Владелец |
| in_progress | Вещь у арендатора | Система (по дате) |
| completed | Вещь возвращена | Владелец |
| reviewed | Отзывы оставлены | Система |
| disputed | Спор | Любая сторона |
| resolved | Спор решён | Админ |
| cancelled | Отменено | Арендатор/Владелец |
| refunded | Деньги возвращены | Система |

**Acceptance Criteria:**
- [ ] Все переходы статусов работают корректно
- [ ] Уведомления отправляются при каждой смене статуса
- [ ] Нельзя перейти в невалидный статус

---

#### FR-011: Подтверждение владельцем
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Владелец подтверждает или отклоняет бронирование |

**Детали:**
- Уведомление владельцу о новом бронировании
- Кнопки "Подтвердить" / "Отклонить"
- Таймаут: 24 часа на ответ

**При подтверждении:**
- Статус → confirmed
- Арендатор получает контакты владельца
- Договариваются о передаче

**При отклонении:**
- Статус → cancelled
- Деньги возвращаются арендатору
- Нужно указать причину

**Acceptance Criteria:**
- [ ] Владелец получает уведомление
- [ ] Может подтвердить/отклонить из уведомления
- [ ] При таймауте — автоотмена и возврат денег

---

#### FR-012: Завершение аренды
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Возврат вещи и расчёт |

**Процесс:**
1. Арендатор возвращает вещь
2. Владелец проверяет состояние
3. Владелец нажимает "Вещь возвращена"
4. Выбирает состояние: "Всё ок" / "Есть повреждения"

**Если всё ок:**
- Депозит возвращается арендатору
- Стоимость аренды (минус комиссия) → владельцу
- Обоим предлагается оставить отзыв

**Если повреждения:**
- Открывается спор (FR-015)
- Деньги заморожены до решения

**Acceptance Criteria:**
- [ ] Только владелец может завершить аренду
- [ ] Депозит возвращается автоматически при "Всё ок"
- [ ] При повреждениях открывается спор

---

### 2.4 Модуль: Коммуникация

#### FR-013: Чат между пользователями
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Общение владельца и арендатора |

**Варианты реализации (MVP):**
1. **Простой вариант:** Кнопка "Написать в Telegram" — открывает чат
2. **Сложный вариант:** Встроенный чат в WebApp

**MVP решение:** Кнопка "Написать в Telegram"

**Acceptance Criteria:**
- [ ] При клике открывается Telegram чат с пользователем
- [ ] Работает только после подтверждения бронирования

---

#### FR-014: Уведомления
| Параметр | Значение |
|----------|----------|
| Приоритет | P0 (Critical) |
| Описание | Push-уведомления через Telegram Bot |

**Типы уведомлений:**

| Событие | Кому | Текст |
|---------|------|-------|
| Новое бронирование | Владельцу | "Новая заявка на {вещь} от {user}" |
| Бронирование подтверждено | Арендатору | "{вещь} подтверждена! Свяжитесь с владельцем" |
| Бронирование отклонено | Арендатору | "{вещь} отклонена. Причина: {reason}" |
| Напоминание о возврате | Арендатору | "Не забудьте вернуть {вещь} сегодня" |
| Вещь возвращена | Обоим | "Аренда завершена. Оставьте отзыв!" |
| Новый отзыв | Получателю | "Вам оставили отзыв: {rating}" |
| Новая вещь в ЖК | Всем в ЖК | "Новое в вашем доме: {вещь}" |

**Acceptance Criteria:**
- [ ] Уведомления приходят через Telegram Bot
- [ ] Можно отключить некоторые типы уведомлений
- [ ] Уведомления содержат кнопки быстрых действий

---

### 2.5 Модуль: Споры и поддержка

#### FR-015: Открытие спора
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Разрешение конфликтных ситуаций |

**Когда можно открыть спор:**
- Вещь повреждена
- Вещь не соответствует описанию
- Владелец не отвечает
- Арендатор не возвращает вещь

**Процесс:**
1. Инициатор описывает проблему + фото
2. Вторая сторона получает уведомление
3. 24 часа на ответ
4. Если не договорились — модератор решает
5. Модератор распределяет депозит

**Acceptance Criteria:**
- [ ] Можно открыть спор из активной аренды
- [ ] Обе стороны могут добавлять комментарии
- [ ] Модератор видит все споры в админке
- [ ] Решение спора = распределение депозита

---

### 2.6 Модуль: Рейтинги и отзывы

#### FR-016: Оставление отзыва
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Двусторонние отзывы после аренды |

**Поля отзыва:**
- Рейтинг (1-5 звёзд)
- Текст (опционально, до 500 символов)

**Владелец оценивает:**
- Арендатора (аккуратность, пунктуальность)

**Арендатор оценивает:**
- Владельца (общение, точность описания)
- Вещь (состояние, соответствие)

**Acceptance Criteria:**
- [ ] Отзыв можно оставить только после завершения аренды
- [ ] Отзыв виден только после того, как оба оставили (или через 7 дней)
- [ ] Нельзя редактировать отзыв после публикации

---

#### FR-017: Рейтинг пользователя
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Расчёт и отображение рейтинга |

**Формула:**
```
rating = SUM(all_ratings) / COUNT(all_ratings)
```

**Отображение:**
- Звёзды (1-5) с одним знаком после запятой
- Количество отзывов
- "Новичок" если <3 отзывов

**Acceptance Criteria:**
- [ ] Рейтинг пересчитывается после каждого отзыва
- [ ] Отдельные рейтинги как владельца и как арендатора
- [ ] Отображается в профиле и на карточке вещи

---

### 2.7 Модуль: Администрирование

#### FR-018: Админ-панель
| Параметр | Значение |
|----------|----------|
| Приоритет | P1 (High) |
| Описание | Управление платформой |

**Функции:**
- Управление ЖК (CRUD)
- Модерация листингов
- Управление пользователями
- Просмотр и решение споров
- Статистика и метрики
- Управление категориями

**Acceptance Criteria:**
- [ ] Доступ только для администраторов
- [ ] Можно блокировать пользователей/листинги
- [ ] Статистика в реальном времени

---

## 3. Нефункциональные требования

### 3.1 Производительность

| Метрика | Требование |
|---------|------------|
| Время загрузки каталога | < 2 сек |
| Время ответа API | < 500 мс (p95) |
| Одновременных пользователей | 100+ |
| Uptime | 99% |

### 3.2 Безопасность

| Требование | Описание |
|------------|----------|
| Аутентификация | Только через Telegram |
| Валидация initData | Проверка подписи Telegram |
| Платежи | Только через YooKassa (PCI DSS) |
| Персональные данные | Соответствие 152-ФЗ |
| HTTPS | Обязательно везде |

### 3.3 Масштабируемость

| Параметр | MVP | Phase 2 |
|----------|-----|---------|
| Пользователей | 1 000 | 10 000 |
| Листингов | 500 | 10 000 |
| Аренд/день | 10 | 100 |
| ЖК | 10 | 100 |

### 3.4 Совместимость

| Платформа | Поддержка |
|-----------|-----------|
| Telegram iOS | Да |
| Telegram Android | Да |
| Telegram Desktop | Да |
| Telegram Web | Да |
| Браузер (без Telegram) | Нет (MVP) |

---

## 4. Технические ограничения

### 4.1 Telegram WebApp

- Максимум 10MB на WebApp
- Ограниченный доступ к API устройства
- Нет background processing
- Зависимость от Telegram серверов

### 4.2 YooKassa

- Минимальный платёж: 1 руб
- Комиссия: 2.8-3.5%
- Вывод средств: T+1
- Требуется ИП/ООО

### 4.3 Инфраструктура

- VPS: Ubuntu 24.04
- База: PostgreSQL
- Кэш: Redis
- Очереди: Celery

---

## 5. Приоритизация (MoSCoW)

### Must Have (MVP)
- FR-001: Регистрация через Telegram
- FR-002: Привязка к ЖК
- FR-004: Просмотр каталога
- FR-005: Карточка вещи
- FR-006: Создание листинга
- FR-008: Бронирование
- FR-009: Оплата
- FR-010: Статусы аренды
- FR-011: Подтверждение владельцем
- FR-012: Завершение аренды
- FR-014: Уведомления

### Should Have (MVP+)
- FR-003: Профиль пользователя
- FR-007: Управление листингами
- FR-013: Чат
- FR-015: Споры
- FR-016: Отзывы
- FR-017: Рейтинг
- FR-018: Админ-панель

### Could Have (Post-MVP)
- Верификация через Госуслуги
- Онлайн-договор аренды
- Страхование
- Календарь доступности
- Избранное
- История аренд

### Won't Have (Out of scope)
- Мобильное приложение
- Веб-версия без Telegram
- B2B функционал
- Доставка
- Мультиязычность

---

## 6. Зависимости

| Зависимость | Тип | Критичность |
|-------------|-----|-------------|
| Telegram Bot API | Внешняя | Критическая |
| Telegram WebApp API | Внешняя | Критическая |
| YooKassa API | Внешняя | Критическая |
| Домовые чаты (для запуска) | Бизнес | Высокая |

---

## 7. Открытые вопросы

| # | Вопрос | Владелец | Статус |
|---|--------|----------|--------|
| 1 | Как верифицировать принадлежность к ЖК? | Product | Открыт |
| 2 | Какой минимальный/максимальный срок аренды? | Product | 1 день / 30 дней |
| 3 | Кто платит комиссию — арендатор или владелец? | Business | Включено в цену |
| 4 | Нужна ли модерация листингов? | Product | Да, постмодерация |
| 5 | Как обрабатывать отмены? | Product | Открыт |

---

## Приложения

### A. Wireframes
*См. документ UX-001*

### B. User Flows
*См. документ UX-002*

### C. API Specification
*См. документ DEV-001*

---

*Документ создан: Product Agent | Дата: 2025-02-05*
