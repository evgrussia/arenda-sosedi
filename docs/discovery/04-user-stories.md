# User Stories: Арендо-Соседи MVP

> Пользовательские истории с критериями приёмки

---
**Документ:** PRODUCT-003
**Версия:** 1.0
**Дата:** 2025-02-05
**Автор:** Product Agent
---

## Обзор

### Роли пользователей

| Роль | Описание |
|------|----------|
| **Арендатор** | Пользователь, который хочет взять вещь в аренду |
| **Владелец** | Пользователь, который сдаёт свою вещь в аренду |
| **Администратор** | Модератор платформы |

> Один пользователь может быть и арендатором, и владельцем.

### Приоритеты

| Приоритет | Описание |
|-----------|----------|
| P0 | Критично для MVP — без этого не запускаемся |
| P1 | Важно для MVP — нужно включить |
| P2 | Желательно — если успеем |
| P3 | После MVP |

---

## Epic 1: Регистрация и профиль

### US-001: Авторизация через Telegram
**Приоритет:** P0

> Как **новый пользователь**,
> Я хочу **авторизоваться через Telegram**,
> Чтобы **не создавать отдельный аккаунт**.

**Acceptance Criteria:**

```gherkin
Scenario: Первый вход в WebApp
  Given пользователь открыл WebApp из Telegram
  When WebApp загрузился
  Then пользователь автоматически авторизован
  And его данные из Telegram (имя, фото) сохранены в профиль
  And он видит экран выбора ЖК

Scenario: Повторный вход
  Given пользователь ранее авторизовался
  When он открывает WebApp
  Then он видит главную страницу (каталог)
  And его сессия сохранена
```

**Технические заметки:**
- Использовать Telegram WebApp initData
- Валидировать подпись на бэкенде
- JWT токен для API

---

### US-002: Выбор жилого комплекса
**Приоритет:** P0

> Как **новый пользователь**,
> Я хочу **указать свой ЖК**,
> Чтобы **видеть вещи только от соседей**.

**Acceptance Criteria:**

```gherkin
Scenario: Первый выбор ЖК
  Given пользователь авторизован и не выбрал ЖК
  When он на экране выбора ЖК
  Then он видит поле поиска и список ЖК
  When он выбирает ЖК "Солнечный"
  Then ЖК сохраняется в профиль
  And он переходит на главную страницу

Scenario: ЖК нет в списке
  Given пользователь на экране выбора ЖК
  When он не находит свой ЖК
  Then он видит кнопку "Мой ЖК не в списке"
  When он нажимает и вводит название
  Then создаётся заявка на добавление ЖК
  And он может продолжить с временным ЖК
```

**Технические заметки:**
- Автокомплит по названию ЖК
- MVP: список ЖК захардкожен или в БД
- Геолокация — post-MVP

---

### US-003: Просмотр своего профиля
**Приоритет:** P1

> Как **пользователь**,
> Я хочу **видеть свой профиль**,
> Чтобы **проверить свою репутацию и данные**.

**Acceptance Criteria:**

```gherkin
Scenario: Просмотр профиля
  Given пользователь авторизован
  When он открывает раздел "Профиль"
  Then он видит:
    | Поле | Значение |
    | Фото | из Telegram |
    | Имя | из Telegram |
    | ЖК | выбранный |
    | Рейтинг владельца | X.X (N отзывов) |
    | Рейтинг арендатора | X.X (N отзывов) |
    | Сделок | N |
```

---

### US-004: Редактирование профиля
**Приоритет:** P2

> Как **пользователь**,
> Я хочу **добавить номер квартиры**,
> Чтобы **соседям было проще меня найти**.

**Acceptance Criteria:**

```gherkin
Scenario: Добавление номера квартиры
  Given пользователь на странице профиля
  When он нажимает "Редактировать"
  Then он может добавить:
    | Поле | Обязательное |
    | Номер квартиры | Нет |
    | Телефон | Нет |
  When он сохраняет
  Then данные обновляются
```

---

## Epic 2: Каталог вещей

### US-005: Просмотр каталога
**Приоритет:** P0

> Как **арендатор**,
> Я хочу **видеть доступные вещи в моём ЖК**,
> Чтобы **найти нужное для аренды**.

**Acceptance Criteria:**

```gherkin
Scenario: Просмотр каталога
  Given пользователь авторизован и выбрал ЖК "Солнечный"
  When он открывает главную страницу
  Then он видит список вещей из ЖК "Солнечный"
  And каждая карточка содержит:
    | Элемент | Пример |
    | Фото | [изображение] |
    | Название | Перфоратор Bosch |
    | Цена | 500 ₽/сутки |
    | Рейтинг | ★ 4.8 |

Scenario: Пустой каталог
  Given в ЖК нет вещей
  When пользователь открывает каталог
  Then он видит сообщение "В вашем доме пока нет вещей"
  And кнопку "Добавить первую вещь"
```

---

### US-006: Фильтрация по категориям
**Приоритет:** P0

> Как **арендатор**,
> Я хочу **фильтровать вещи по категориям**,
> Чтобы **быстрее найти нужное**.

**Acceptance Criteria:**

```gherkin
Scenario: Выбор категории
  Given пользователь на странице каталога
  When он нажимает на категорию "Инструменты"
  Then каталог показывает только инструменты
  And выбранная категория подсвечена

Scenario: Сброс фильтра
  Given применён фильтр по категории
  When пользователь нажимает "Все категории"
  Then показываются все вещи
```

**Категории MVP:**
1. Инструменты
2. Спорт
3. Техника
4. Детское
5. Мероприятия
6. Другое

---

### US-007: Поиск вещей
**Приоритет:** P1

> Как **арендатор**,
> Я хочу **искать вещи по названию**,
> Чтобы **найти конкретную вещь**.

**Acceptance Criteria:**

```gherkin
Scenario: Поиск по названию
  Given пользователь на странице каталога
  When он вводит "дрель" в поле поиска
  Then каталог показывает вещи с "дрель" в названии или описании

Scenario: Ничего не найдено
  Given пользователь ищет "квадрокоптер"
  When в ЖК нет такой вещи
  Then он видит "Ничего не найдено"
  And предложение "Создать запрос" (post-MVP)
```

---

### US-008: Просмотр карточки вещи
**Приоритет:** P0

> Как **арендатор**,
> Я хочу **видеть подробности о вещи**,
> Чтобы **решить, подходит ли она мне**.

**Acceptance Criteria:**

```gherkin
Scenario: Открытие карточки
  Given пользователь в каталоге
  When он нажимает на карточку вещи
  Then открывается детальная страница с:
    | Элемент | Описание |
    | Фото | Галерея (свайп) |
    | Название | Перфоратор Bosch GBH 2-26 |
    | Описание | Мощный, есть сверла... |
    | Категория | Инструменты |
    | Цена | 500 ₽/сутки |
    | Депозит | 1000 ₽ |
    | Рейтинг вещи | ★ 4.8 (5 аренд) |
    | Владелец | Иван (★ 4.9) |
    | Статус | Доступна / Занята до DD.MM |
    | Кнопка | Забронировать |
```

---

## Epic 3: Добавление вещей

### US-009: Добавление новой вещи
**Приоритет:** P0

> Как **владелец**,
> Я хочу **добавить свою вещь в каталог**,
> Чтобы **сдавать её в аренду и зарабатывать**.

**Acceptance Criteria:**

```gherkin
Scenario: Успешное добавление
  Given владелец нажал "Добавить вещь"
  When он заполняет форму:
    | Поле | Значение | Обязательное |
    | Фото | 1-5 фото | Да (мин 1) |
    | Название | Перфоратор Bosch | Да |
    | Описание | Мощный инструмент... | Да |
    | Категория | Инструменты | Да |
    | Цена/сутки | 500 | Да |
    | Депозит | 1000 | Нет (default = цена*2) |
  And нажимает "Опубликовать"
  Then вещь появляется в каталоге
  And владелец получает уведомление

Scenario: Валидация полей
  Given владелец заполняет форму
  When он не добавил фото
  Then кнопка "Опубликовать" неактивна
  And показывается подсказка "Добавьте хотя бы 1 фото"
```

**Валидация:**
- Фото: 1-5 шт, до 5MB каждое
- Название: 3-100 символов
- Описание: 10-1000 символов
- Цена: 50-50000 ₽
- Депозит: 0-100000 ₽

---

### US-010: Редактирование вещи
**Приоритет:** P1

> Как **владелец**,
> Я хочу **редактировать свою вещь**,
> Чтобы **обновить цену или описание**.

**Acceptance Criteria:**

```gherkin
Scenario: Редактирование доступной вещи
  Given вещь не находится в активной аренде
  When владелец нажимает "Редактировать"
  Then он может изменить любое поле
  When он сохраняет
  Then изменения применяются

Scenario: Нельзя редактировать во время аренды
  Given вещь сейчас в аренде
  When владелец пытается редактировать
  Then он видит "Нельзя редактировать во время активной аренды"
```

---

### US-011: Скрытие/удаление вещи
**Приоритет:** P1

> Как **владелец**,
> Я хочу **временно скрыть вещь**,
> Чтобы **не получать заявки, пока она мне нужна**.

**Acceptance Criteria:**

```gherkin
Scenario: Скрытие вещи
  Given вещь опубликована и доступна
  When владелец нажимает "Скрыть"
  Then вещь исчезает из каталога
  And остаётся в "Мои вещи" с пометкой "Скрыта"

Scenario: Удаление вещи
  Given вещь не в аренде
  When владелец нажимает "Удалить"
  Then появляется подтверждение
  When он подтверждает
  Then вещь удаляется навсегда
```

---

## Epic 4: Бронирование

### US-012: Бронирование вещи
**Приоритет:** P0

> Как **арендатор**,
> Я хочу **забронировать вещь на нужные даты**,
> Чтобы **использовать её**.

**Acceptance Criteria:**

```gherkin
Scenario: Успешное бронирование
  Given арендатор на странице вещи
  And вещь доступна
  When он нажимает "Забронировать"
  Then открывается форма бронирования
  When он выбирает даты: 15.02 - 17.02 (2 дня)
  Then он видит расчёт:
    | Строка | Сумма |
    | Аренда (500 × 2) | 1000 ₽ |
    | Депозит | 1000 ₽ |
    | Итого к оплате | 2000 ₽ |
  When он нажимает "Оплатить"
  Then он переходит на страницу оплаты YooKassa

Scenario: Вещь занята в выбранные даты
  Given вещь забронирована на 15-17.02
  When арендатор выбирает 16.02 - 18.02
  Then он видит "Вещь занята в эти даты"
  And недоступные даты подсвечены в календаре
```

---

### US-013: Оплата бронирования
**Приоритет:** P0

> Как **арендатор**,
> Я хочу **оплатить бронирование картой**,
> Чтобы **завершить процесс**.

**Acceptance Criteria:**

```gherkin
Scenario: Успешная оплата
  Given арендатор на странице оплаты YooKassa
  When он вводит данные карты и подтверждает
  Then оплата проходит
  And он возвращается в WebApp
  And видит "Бронирование отправлено владельцу"
  And владелец получает уведомление

Scenario: Неуспешная оплата
  Given оплата не прошла
  Then арендатор видит ошибку
  And может попробовать снова
```

---

### US-014: Подтверждение владельцем
**Приоритет:** P0

> Как **владелец**,
> Я хочу **подтвердить или отклонить заявку**,
> Чтобы **контролировать, кому сдаю вещь**.

**Acceptance Criteria:**

```gherkin
Scenario: Подтверждение заявки
  Given владелец получил уведомление о заявке
  When он открывает заявку
  Then он видит:
    | Информация |
    | Вещь: Перфоратор |
    | Арендатор: Павел (★ 4.5) |
    | Даты: 15.02 - 17.02 |
    | Сумма: 1000 ₽ (вы получите 875 ₽) |
  When он нажимает "Подтвердить"
  Then бронирование подтверждено
  And арендатор получает уведомление с контактами владельца

Scenario: Отклонение заявки
  Given владелец хочет отклонить заявку
  When он нажимает "Отклонить"
  Then он должен указать причину:
    | Причины |
    | Вещь сейчас нужна мне |
    | Даты не подходят |
    | Другая причина |
  When он отклоняет
  Then бронирование отменено
  And арендатору возвращаются деньги
```

---

### US-015: Таймаут подтверждения
**Приоритет:** P1

> Как **арендатор**,
> Я хочу **получить деньги обратно, если владелец не отвечает**,
> Чтобы **не терять время**.

**Acceptance Criteria:**

```gherkin
Scenario: Таймаут 24 часа
  Given прошло 24 часа с момента бронирования
  And владелец не ответил
  Then бронирование автоматически отменяется
  And арендатору возвращаются деньги
  And владелец получает уведомление о пропущенной заявке
```

---

## Epic 5: Процесс аренды

### US-016: Передача вещи
**Приоритет:** P0

> Как **арендатор**,
> Я хочу **связаться с владельцем для получения вещи**,
> Чтобы **договориться о встрече**.

**Acceptance Criteria:**

```gherkin
Scenario: Контакт с владельцем
  Given бронирование подтверждено
  When арендатор открывает детали аренды
  Then он видит кнопку "Написать владельцу"
  When он нажимает
  Then открывается чат в Telegram с владельцем

Scenario: До подтверждения
  Given бронирование ещё не подтверждено
  When арендатор открывает детали
  Then кнопка "Написать владельцу" неактивна
  And показывается "Ожидает подтверждения"
```

---

### US-017: Начало аренды
**Приоритет:** P1

> Как **система**,
> Я хочу **отслеживать начало аренды**,
> Чтобы **обновлять статусы**.

**Acceptance Criteria:**

```gherkin
Scenario: Автоматический старт
  Given бронирование подтверждено на 15.02 - 17.02
  When наступает 15.02
  Then статус меняется на "В аренде"
  And вещь отображается как "Занята"
```

---

### US-018: Завершение аренды владельцем
**Приоритет:** P0

> Как **владелец**,
> Я хочу **подтвердить возврат вещи**,
> Чтобы **получить оплату и освободить депозит**.

**Acceptance Criteria:**

```gherkin
Scenario: Вещь возвращена без проблем
  Given аренда в статусе "В аренде"
  When арендатор вернул вещь
  And владелец нажимает "Вещь возвращена"
  Then он выбирает состояние:
    | ✓ Всё в порядке |
    | ✗ Есть повреждения |
  When он выбирает "Всё в порядке"
  Then:
    | Действие | Результат |
    | Депозит | Возвращается арендатору |
    | Оплата (минус комиссия) | Переводится владельцу |
    | Статус | Завершена |
  And обоим предлагается оставить отзыв

Scenario: Вещь повреждена
  Given владелец выбирает "Есть повреждения"
  Then открывается форма создания спора
  And деньги остаются заморожены
```

---

### US-019: Напоминание о возврате
**Приоритет:** P1

> Как **арендатор**,
> Я хочу **получить напоминание о возврате**,
> Чтобы **не забыть вернуть вещь**.

**Acceptance Criteria:**

```gherkin
Scenario: Напоминание в последний день
  Given сегодня 17.02 (последний день аренды)
  When 10:00
  Then арендатор получает уведомление:
    "Не забудьте вернуть Перфоратор Bosch сегодня"
```

---

## Epic 6: Отзывы и рейтинги

### US-020: Оставление отзыва
**Приоритет:** P1

> Как **участник аренды**,
> Я хочу **оставить отзыв**,
> Чтобы **помочь другим пользователям**.

**Acceptance Criteria:**

```gherkin
Scenario: Отзыв арендатора о владельце
  Given аренда завершена
  When арендатор открывает завершённую аренду
  Then он видит форму отзыва:
    | Поле | Описание |
    | Рейтинг владельца | 1-5 звёзд |
    | Рейтинг вещи | 1-5 звёзд |
    | Комментарий | Текст (опционально) |
  When он заполняет и отправляет
  Then отзыв сохраняется

Scenario: Отзыв владельца об арендаторе
  Given аренда завершена
  When владелец открывает аренду
  Then он видит форму:
    | Поле | Описание |
    | Рейтинг арендатора | 1-5 звёзд |
    | Комментарий | Текст (опционально) |
```

---

### US-021: Просмотр отзывов
**Приоритет:** P1

> Как **пользователь**,
> Я хочу **видеть отзывы о других пользователях**,
> Чтобы **решить, доверять ли им**.

**Acceptance Criteria:**

```gherkin
Scenario: Отзывы в профиле
  Given пользователь открыл профиль Ивана
  Then он видит:
    | Информация |
    | Рейтинг: ★ 4.8 (12 отзывов) |
    | Последние отзывы (список) |

Scenario: Скрытие до взаимного отзыва
  Given Павел оставил отзыв, Иван — нет
  Then отзыв Павла скрыт
  When Иван оставляет отзыв ИЛИ проходит 7 дней
  Then оба отзыва становятся видимыми
```

---

## Epic 7: Споры

### US-022: Создание спора
**Приоритет:** P1

> Как **участник аренды**,
> Я хочу **открыть спор при проблеме**,
> Чтобы **получить справедливое решение**.

**Acceptance Criteria:**

```gherkin
Scenario: Спор от владельца (повреждение)
  Given владелец завершает аренду с "Есть повреждения"
  Then открывается форма спора:
    | Поле | Описание |
    | Описание проблемы | Текст |
    | Фото повреждений | 1-5 фото |
    | Запрашиваемая сумма | Из депозита |
  When он отправляет
  Then арендатор получает уведомление
  And деньги заморожены

Scenario: Спор от арендатора (вещь не соответствует)
  Given арендатор получил вещь
  When она не соответствует описанию
  Then он может открыть спор с:
    | Поле |
    | Описание проблемы |
    | Фото |
    | Запрос на возврат |
```

---

### US-023: Разрешение спора
**Приоритет:** P1

> Как **администратор**,
> Я хочу **разрешить спор**,
> Чтобы **справедливо распределить средства**.

**Acceptance Criteria:**

```gherkin
Scenario: Решение в пользу владельца
  Given администратор рассматривает спор
  When он решает в пользу владельца
  Then часть депозита переводится владельцу
  And остаток возвращается арендатору
  And обе стороны уведомлены

Scenario: Решение в пользу арендатора
  Given администратор решает в пользу арендатора
  Then депозит полностью возвращается арендатору
  And стоимость аренды также возвращается (частично/полностью)
```

---

## Epic 8: Уведомления

### US-024: Получение уведомлений
**Приоритет:** P0

> Как **пользователь**,
> Я хочу **получать уведомления о важных событиях**,
> Чтобы **не пропустить заявки и изменения**.

**Acceptance Criteria:**

```gherkin
Scenario: Уведомление о новой заявке
  Given Павел забронировал вещь Ивана
  Then Иван получает push-уведомление:
    "Новая заявка на Перфоратор от Павел"
  And уведомление содержит кнопки:
    | Подтвердить | Отклонить | Подробнее |

Scenario: Типы уведомлений
  Given следующие события:
    | Событие | Получатель |
    | Новая заявка | Владелец |
    | Заявка подтверждена | Арендатор |
    | Заявка отклонена | Арендатор |
    | Напоминание о возврате | Арендатор |
    | Вещь возвращена | Оба |
    | Новый отзыв | Получатель |
    | Новая вещь в ЖК | Все в ЖК |
```

---

### US-025: Настройка уведомлений
**Приоритет:** P2

> Как **пользователь**,
> Я хочу **настроить типы уведомлений**,
> Чтобы **не получать лишние**.

**Acceptance Criteria:**

```gherkin
Scenario: Отключение уведомлений о новых вещах
  Given пользователь в настройках
  When он отключает "Новые вещи в ЖК"
  Then он больше не получает эти уведомления
  And критические уведомления (заявки, оплаты) нельзя отключить
```

---

## Epic 9: Админ-панель

### US-026: Модерация листингов
**Приоритет:** P1

> Как **администратор**,
> Я хочу **модерировать вещи**,
> Чтобы **удалять неподходящий контент**.

**Acceptance Criteria:**

```gherkin
Scenario: Скрытие листинга
  Given есть жалоба на листинг
  When админ открывает листинг
  Then он может:
    | Скрыть | С уведомлением владельцу |
    | Удалить | С причиной |
    | Одобрить | Если жалоба неправомерна |
```

---

### US-027: Управление ЖК
**Приоритет:** P1

> Как **администратор**,
> Я хочу **управлять списком ЖК**,
> Чтобы **добавлять новые дома**.

**Acceptance Criteria:**

```gherkin
Scenario: Добавление ЖК
  Given админ в разделе ЖК
  When он нажимает "Добавить"
  Then он вводит:
    | Название | ЖК Солнечный |
    | Адрес | ул. Ленина, 1 |
    | Город | Москва |
  When сохраняет
  Then ЖК появляется в списке выбора
```

---

## Матрица приоритетов

### P0 — Блокеры MVP

| ID | User Story |
|----|------------|
| US-001 | Авторизация через Telegram |
| US-002 | Выбор ЖК |
| US-005 | Просмотр каталога |
| US-006 | Фильтрация по категориям |
| US-008 | Карточка вещи |
| US-009 | Добавление вещи |
| US-012 | Бронирование |
| US-013 | Оплата |
| US-014 | Подтверждение владельцем |
| US-018 | Завершение аренды |
| US-024 | Уведомления |

### P1 — Важно для MVP

| ID | User Story |
|----|------------|
| US-003 | Профиль пользователя |
| US-007 | Поиск вещей |
| US-010 | Редактирование вещи |
| US-011 | Скрытие/удаление |
| US-015 | Таймаут подтверждения |
| US-016 | Контакт с владельцем |
| US-017 | Начало аренды |
| US-019 | Напоминание о возврате |
| US-020 | Отзывы |
| US-021 | Просмотр отзывов |
| US-022 | Создание спора |
| US-023 | Разрешение спора |
| US-026 | Модерация |
| US-027 | Управление ЖК |

### P2 — Желательно

| ID | User Story |
|----|------------|
| US-004 | Редактирование профиля |
| US-025 | Настройка уведомлений |

---

*Документ создан: Product Agent | Дата: 2025-02-05*
